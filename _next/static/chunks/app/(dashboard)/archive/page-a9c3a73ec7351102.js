(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[998],{7331:function(e,t,r){Promise.resolve().then(r.bind(r,9858))},9858:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return page}});var a=r(7437),n=r(4033),l=r(2265),s=r(2836),i=r(9050);let createPath=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URL(e,window.location.origin);return Object.keys(t).forEach(e=>r.searchParams.append(e,t[e].toString())),r},RecordingList=e=>{let{recodingList:t,onDelete:r}=e,handleDelete=e=>{r(e)};return(0,a.jsxs)("div",{children:[0===t.length&&(0,a.jsx)("p",{children:"録画はありません"}),(0,a.jsx)("ul",{className:"grid list-disc gap-y-4 pl-4 empty:hidden",children:t.map(e=>{let{start:t,end:r}=e;return(0,a.jsx)("li",{children:(0,a.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,a.jsxs)(s.r,{href:createPath("".concat(location.pathname),{recordKey:t}),children:[new Date(t).toLocaleString()," ~ ",new Date(r).toLocaleString(),"の録画"]}),(0,a.jsx)(i.z,{size:"small",variant:"secondary",onClick:()=>handleDelete(t),children:"削除"})]})},t)})})]})};var o=r(6793);let ArchiveList=()=>{let[e,t]=(0,l.useState)([]);(0,l.useEffect)(()=>{(0,o.fQ)("DeviceOrientationVisualizationDB","rangeStore").then(e=>{let r=e.result;t(r)})},[]);let r=e.sort((e,t)=>e.start<t.start?1:e.start>t.start?-1:0);return(0,a.jsx)("div",{className:"grid gap-y-9",children:(0,a.jsx)("div",{children:(0,a.jsx)(RecordingList,{recodingList:r,onDelete:e=>{Promise.all([(0,o.DO)("DeviceOrientationVisualizationDB","recordStore",e.toString()),(0,o.DO)("DeviceOrientationVisualizationDB","rangeStore",e.toString())]).then(()=>{(0,o.fQ)("DeviceOrientationVisualizationDB","rangeStore").then(e=>{let r=e.result;t(r)})})}})})})};var c=r(305);let d={alpha:{bgColor:"bg-rose-300",color:"text-neutral-900"},gamma:{bgColor:"bg-green-300",color:"text-neutral-900"},beta:{bgColor:"bg-sky-300",color:"text-neutral-900"}},DeviceOrientationValues=e=>{let{alpha:t,gamma:r,beta:n}=e;return(0,a.jsxs)("dl",{className:"space-y-8",children:[(0,a.jsx)(DeviceOrientationValue,{type:"alpha",value:t}),(0,a.jsx)(DeviceOrientationValue,{type:"gamma",value:r}),(0,a.jsx)(DeviceOrientationValue,{type:"beta",value:n})]})},DeviceOrientationValue=e=>{let{type:t,value:r}=e;return(0,a.jsxs)("div",{className:"grid min-w-[8rem] grid-rows-2 gap-y-2 rounded-md p-4 ".concat(d[t].bgColor," ").concat(d[t].color),children:[(0,a.jsxs)("dt",{children:[t," の値"]}),(0,a.jsx)("dd",{children:r})]})};var u=r(952);let MainVisualGraph=e=>{let{data:t,width:r,height:n,currentTimestamp:s}=e,i=(0,l.useRef)(null),o=(0,l.useRef)(null),c=(0,l.useMemo)(()=>({top:20,right:20,bottom:20,left:50}),[]),d=r-c.left-c.right,g=n-c.top-c.bottom,m=t[0],h=t[t.length-1],f=(0,l.useMemo)(()=>u.BYU().domain([m.timestamp,h.timestamp]).range([0,d]),[m,h,d]),x=(0,l.useMemo)(()=>u.BYU().domain([-180,360]).range([g,0]),[g]),{gamma:p,alpha:j,beta:v}=(0,l.useMemo)(()=>t.reduce((e,t)=>{let r=t.timestamp,a={gamma:[[r,t.gamma],...e.gamma],alpha:[[r,t.alpha],...e.alpha],beta:[[r,t.beta],...e.beta]};return a},{gamma:[],alpha:[],beta:[]}),[t]),b=u.jvg().x(e=>f(e[0])).y(e=>x(e[1]));(0,l.useEffect)(()=>{let e=i.current;if(e)return u.Ys(e).call(u.LLu(f).ticks(4).tickFormat(e=>{let t=new Date(e);return r<640?"".concat(t.getHours(),":").concat(t.getMinutes(),":").concat(t.getSeconds()):"".concat(t.getMonth()+1,"/").concat(t.getDate()," ").concat(t.getHours(),":").concat(t.getMinutes(),":").concat(t.getSeconds())})),()=>{u.Ys(e).selectAll("g").remove()}},[i,f,r]),(0,l.useEffect)(()=>{let e=o.current;if(e)return u.Ys(e).call(u.y4O(x).tickValues([-180,-90,0,90,180,270,360]).tickFormat(e=>360===e?"360deg":"".concat(e))),()=>{u.Ys(e).selectAll("g").remove()}},[o,x]);let D=f(s),k=s>=m.timestamp&&s<=h.timestamp;return(0,a.jsxs)("svg",{width:r,height:n,children:[(0,a.jsx)("title",{children:"デバイスの回転の値（alpha、beta、gamma）の折れ線グラフ"}),(0,a.jsx)("g",{ref:i,transform:"translate(".concat(c.left,",").concat(n-c.bottom,")")}),(0,a.jsx)("g",{ref:o,transform:"translate(".concat(c.left,",").concat(c.bottom,")")}),(0,a.jsx)("path",{className:"stroke-rose-300",transform:"translate(".concat(c.left,", ").concat(c.top,")"),fill:"none",strokeWidth:"2",d:b(j)}),(0,a.jsx)("path",{className:"stroke-green-300",transform:"translate(".concat(c.left,", ").concat(c.top,")"),fill:"none",strokeWidth:"2",d:b(p)}),(0,a.jsx)("path",{className:"stroke-sky-300",transform:"translate(".concat(c.left,", ").concat(c.top,")"),fill:"none",stroke:"blue",strokeWidth:"2",d:b(v)}),k&&(0,a.jsx)("line",{transform:"translate(".concat(c.left,", ").concat(c.top,")"),x1:D,x2:D,y1:"0",y2:n-c.bottom-c.top,fill:"none",stroke:"rgb(239 68 68)",strokeWidth:4})]})},SeekBar=e=>{let{data:t,width:r,height:n,currentTimestamp:s,onBrush:i}=e,o=(0,l.useRef)(null),c=(0,l.useRef)(null),d=(0,l.useRef)(null),g=t[0],m=t[t.length-1],h=(0,l.useMemo)(()=>u.BYU().domain([g.timestamp,m.timestamp]).range([0,r]),[g,m,r]),f=(0,l.useMemo)(()=>u.BYU().domain([-180,360]).range([n,0]),[n]),{gamma:x,alpha:p,beta:j}=(0,l.useMemo)(()=>t.reduce((e,t)=>{let r=t.timestamp;return{gamma:[[r,t.gamma],...e.gamma],alpha:[[r,t.alpha],...e.alpha],beta:[[r,t.beta],...e.beta]}},{gamma:[],alpha:[],beta:[]}),[t]),v=(0,l.useMemo)(()=>u.Yud().extent([[0,0],[r,n]]).on("brush",e=>{let t=h.invert(e.selection[0]),r=h.invert(e.selection[1]);i([t,r])}).on("end",e=>{e.selection||i([0,r])}),[r,n,h,i]),b=u.jvg().x(e=>h(e[0])).y(e=>f(e[1]));(0,l.useEffect)(()=>{let e=o.current;if(e)return u.Ys(e).call(u.LLu(h).ticks(4).tickFormat(e=>{let t=new Date(e);return"".concat(t.getMonth()+1,"/").concat(t.getDate(),"/").concat(t.getHours()," ").concat(t.getMinutes(),":").concat(t.getSeconds())})),()=>{u.Ys(e).selectAll("g").remove()}},[o,h]),(0,l.useEffect)(()=>{let e=c.current;if(e)return u.Ys(e).call(u.y4O(f).tickValues([-180,-90,0,90,180,270,360])),()=>{u.Ys(e).selectAll("g").remove()}},[c,f]),(0,l.useEffect)(()=>{let e=d.current;if(e)return u.Ys(e).call(v),()=>{u.Ys(e).selectAll("g").remove()}},[v]);let D=h(s);return(0,a.jsxs)("svg",{width:r,height:n,children:[(0,a.jsx)("title",{children:"デバイスの回転の値（alpha、beta、gamma）の折れ線グラフのシークバー"}),(0,a.jsx)("path",{className:"stroke-rose-300",fill:"none",strokeWidth:"2",d:b(p)}),(0,a.jsx)("path",{className:"stroke-green-300",fill:"none",strokeWidth:"2",d:b(x)}),(0,a.jsx)("path",{className:"stroke-sky-300",fill:"none",stroke:"blue",strokeWidth:"2",d:b(j)}),(0,a.jsx)("g",{ref:d}),(0,a.jsx)("line",{x1:D,x2:D,y1:"0",y2:n,fill:"none",stroke:"rgb(239 68 68)",strokeWidth:4})]})},LineGraph=e=>{let{data:t,width:r=640,height:n=320,currentData:s}=e,[i,o]=(0,l.useState)(null),c=(0,l.useCallback)(e=>{o(e)},[]),d=(0,l.useMemo)(()=>t.filter(e=>{if(null===i)return!0;let t=e.timestamp,r=t>=i[0]&&t<=i[1];return r}),[t,i]),u=d.length>1?d:t,g=s.timestamp;return(0,a.jsxs)("div",{className:"grid gap-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(MainVisualGraph,{data:u,width:r,height:Math.max(0,n-50-16),currentTimestamp:g})}),(0,a.jsx)("div",{className:"inline-block border border-neutral-700",children:(0,a.jsx)(SeekBar,{data:t,onBrush:c,width:r,height:50,currentTimestamp:g})})]})},DeviceOrientationRange=e=>{let{data:t,currentData:r}=e,[n,s]=(0,l.useState)({width:0,height:0}),i=(0,l.useCallback)(e=>{if(null===e)return;let t=new AbortController,handleResize=()=>{s({width:e.clientWidth,height:e.clientHeight})};return handleResize(),window.addEventListener("resize",handleResize,{signal:t.signal}),()=>{t.abort()}},[]);return(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-[1fr_auto]",children:[(0,a.jsx)("div",{ref:i,className:"relative aspect-video w-full",children:(0,a.jsx)("div",{className:"absolute h-full w-full",children:(0,a.jsx)(LineGraph,{data:t,width:n.width,height:n.height,currentData:r})})}),(0,a.jsx)("div",{children:(0,a.jsx)(DeviceOrientationValues,{...r})})]})};var g=r(5318);let useElapsedTime=()=>{let e=(0,l.useRef)(null),t=(0,l.useRef)(null),[r,a]=(0,l.useState)(!1),[n,s]=(0,l.useState)(0),i=(0,l.useCallback)(()=>{a(!0)},[]),o=(0,l.useCallback)(()=>{a(!1)},[]),c=(0,l.useCallback)(()=>{s(0)},[]),d=(0,l.useCallback)(()=>{if(r){let r=Date.now();if(t.current=requestAnimationFrame(d),null===e.current){e.current=r;return}let a=r-e.current;s(e=>e+a),e.current=r}else e.current=null},[r]);return(0,l.useEffect)(()=>(t.current=requestAnimationFrame(d),()=>{t.current&&cancelAnimationFrame(t.current)}),[d]),{start:i,stop:o,reset:c,isRunning:r,elapsedTime:n}},ArchiveDetail=e=>{var t;let{recordKey:r}=e,[n,d]=(0,l.useState)([]);(0,l.useEffect)(()=>{(0,o.ZS)("DeviceOrientationVisualizationDB","recordStore",r).then(async e=>{let t=await (0,c.r)(e.result);d(t.reverse())})},[r]);let{start:u,stop:m,reset:h,isRunning:f,elapsedTime:x}=useElapsedTime();if(0===n.length)return(0,a.jsx)("p",{children:"読み込み中..."});let p=n[0],j=null!==(t=n.find(e=>e.timestamp>=p.timestamp+x))&&void 0!==t?t:n[n.length-1];return(0,a.jsxs)("div",{className:"grid gap-y-12",children:[(0,a.jsx)(s.r,{href:"/archive",children:"録画一覧に戻る"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-[auto_1fr]",children:[(0,a.jsx)("div",{children:(0,a.jsx)(g.S,{currentTime:new Date(j.timestamp)})}),(0,a.jsx)("div",{children:(0,a.jsx)(DeviceOrientationRange,{data:n,currentData:j})})]}),(0,a.jsxs)("div",{className:"flex gap-x-4",children:[(0,a.jsx)(i.z,{onClick:u,disabled:f,children:"再生"}),(0,a.jsx)(i.z,{onClick:m,disabled:!f,children:"停止"}),(0,a.jsx)(i.z,{onClick:h,children:"リセット"})]})]})};var page=()=>{let e=(0,n.useSearchParams)(),t=e.get("recordKey");return null===t?(0,a.jsx)(ArchiveList,{}):(0,a.jsx)(ArchiveDetail,{recordKey:t})}},9050:function(e,t,r){"use strict";r.d(t,{z:function(){return s}});var a=r(7437),n=r(2265),l=r(3986);let s=(0,n.forwardRef)((e,t)=>{let{children:r,variant:n,size:s,className:i,disabled:o,...c}=e;return(0,a.jsx)("button",{...c,ref:t,className:(0,l.m)("flex items-center justify-between gap-x-2 whitespace-nowrap rounded-md bg-neutral-50 px-4 py-2 text-neutral-900 hover:opacity-70 focus:border-neutral-50",i,"secondary"===n&&"bg-neutral-900 border border-neutral-50 text-neutral-50 hover:opacity-70","small"===s&&"text-sm px-2 py-1 rounded",o&&"cursor-not-allowed opacity-20 hover:opacity-20"),children:r})});s.displayName="Button"},5318:function(e,t,r){"use strict";r.d(t,{S:function(){return Clock}});var a=r(7437);let zeroPadding=(e,t)=>String(e).padStart(t,"0"),formatDateTimeToDigital=e=>{let t=e.getFullYear(),r=zeroPadding(e.getMonth()+1,2),a=zeroPadding(e.getDate(),2),n=zeroPadding(e.getHours(),2),l=zeroPadding(e.getMinutes(),2),s=zeroPadding(e.getSeconds(),2),i=zeroPadding(e.getMilliseconds(),3);return{date:"".concat(t,"-").concat(r,"-").concat(a),time:"".concat(n,":").concat(l,":").concat(s,".").concat(i)}},splitDateTime=e=>{let t=e.getFullYear(),r=e.getMonth()+1,a=e.getDate(),n=e.getHours(),l=e.getMinutes(),s=e.getSeconds(),i=e.getMilliseconds();return{year:t,month:r,date:a,hours:n,minutes:l,seconds:s,milliseconds:i}},AnalogClock=e=>{let{dateTime:t}=e,{hours:r,minutes:n,seconds:l}=splitDateTime(t);return(0,a.jsxs)("div",{className:"relative aspect-[1/1] w-[12rem] rounded-full bg-neutral-800 sm:w-[15rem]",children:[(0,a.jsx)("div",{style:{"--rotate-deg":"".concat((r+n/60)*30-90,"deg")},className:"absolute left-1/2 top-1/2 z-10 h-[6px] w-[30%] origin-[center_left] rotate-[var(--rotate-deg)] bg-neutral-50"}),(0,a.jsx)("div",{style:{"--rotate-deg":"".concat(6*n-90,"deg")},className:"absolute left-1/2 top-1/2 z-10 h-[4px] w-[40%] origin-[center_left] rotate-[var(--rotate-deg)] bg-neutral-50"}),(0,a.jsx)("div",{style:{"--rotate-deg":"".concat(6*l-90,"deg")},className:"absolute left-1/2 top-1/2 z-10 h-[4px]  w-[40%] origin-[center_left] rotate-[var(--rotate-deg)] bg-orange-500"}),(0,a.jsxs)("ol",{className:"relative h-full w-full text-center [&>li]:-translate-x-1/2 [&>li]:-translate-y-1/2",children:[(0,a.jsx)("li",{className:"absolute left-[70%] top-[14%]",children:"1"}),(0,a.jsx)("li",{className:"absolute left-[86%] top-[28%]",children:"2"}),(0,a.jsx)("li",{className:"absolute left-[90%] top-[50%]",children:"3"}),(0,a.jsx)("li",{className:"absolute left-[86%] top-[72%]",children:"4"}),(0,a.jsx)("li",{className:"absolute left-[70%] top-[86%]",children:"5"}),(0,a.jsx)("li",{className:"absolute left-[50%] top-[90%]",children:"6"}),(0,a.jsx)("li",{className:"absolute left-[30%] top-[86%]",children:"7"}),(0,a.jsx)("li",{className:"absolute left-[14%] top-[72%]",children:"8"}),(0,a.jsx)("li",{className:"absolute left-[10%] top-[50%]",children:"9"}),(0,a.jsx)("li",{className:"absolute left-[14%] top-[28%]",children:"10"}),(0,a.jsx)("li",{className:"absolute left-[30%] top-[14%]",children:"11"}),(0,a.jsx)("li",{className:"absolute left-[50%] top-[10%]",children:"12"})]})]})},DigitalClock=e=>{let{dateTime:t}=e,{date:r,time:n}=formatDateTimeToDigital(t);return(0,a.jsxs)("span",{className:"grid grid-rows-2 text-2xl",children:[(0,a.jsx)("span",{children:r}),(0,a.jsx)("span",{children:n})]})},Clock=e=>{let{currentTime:t}=e;return(0,a.jsxs)("div",{className:"grid grid-cols-[auto_1fr] gap-8 text-center lg:grid-cols-1 lg:grid-rows-[auto_1fr]",children:[(0,a.jsx)("div",{children:(0,a.jsx)(AnalogClock,{dateTime:t})}),(0,a.jsx)("div",{className:"flex items-center lg:block",children:(0,a.jsx)(DigitalClock,{dateTime:t})})]})}},2836:function(e,t,r){"use strict";r.d(t,{r:function(){return Link}});var a=r(7437),n=r(1396),l=r.n(n),s=r(3986);let i={none:"no-underline",hover:"hover:underline",normal:"underline hover:no-underline"},Link=e=>{let{children:t,className:r,underline:n="normal",...o}=e;return(0,a.jsx)(l(),{...o,className:(0,s.m)("block",i[n],r),children:t})}},305:function(e,t,r){"use strict";r.d(t,{I:function(){return convertArrayToBlob},r:function(){return readBlob}});let convertArrayToBlob=e=>new Blob([JSON.stringify(e)],{type:"application/json"}),readBlob=e=>new Promise((t,r)=>{let a=new FileReader;a.readAsText(e),a.onload=()=>{let e=a.result;"string"==typeof e?t(JSON.parse(e)):r("Blobの読み込みに失敗しました")}})},6793:function(e,t,r){"use strict";r.d(t,{DO:function(){return deleteIndexedDBValue},ZS:function(){return readIndexedDBValue},fQ:function(){return readIndexedDBAll},fo:function(){return saveOrientationData}});let opneIndexedDB=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Promise((r,a)=>{let n=indexedDB.open(e,t);n.addEventListener("upgradeneeded",()=>{let e=n.result;e.createObjectStore("recordStore",{autoIncrement:!0}),e.createObjectStore("rangeStore",{autoIncrement:!0})}),n.addEventListener("success",()=>{r(n)}),n.addEventListener("error",e=>{console.error("データベースを開けませんでした"),a(e)})})},saveOrientationData=async(e,t,r)=>{let a=await opneIndexedDB("DeviceOrientationVisualizationDB",1),n=a.result,l=n.objectStoreNames;if(l.contains("recordStore")){let t=n.transaction("recordStore","readwrite"),a=t.objectStore("recordStore");a.add(r,e.toString()),t.addEventListener("complete",()=>{console.log("データを追加しました")})}else console.error("オブジェクトストアが存在しません");if(l.contains("rangeStore")){let r=n.transaction("rangeStore","readwrite"),a=r.objectStore("rangeStore");a.add({start:e,end:t},e.toString()),r.addEventListener("complete",()=>{console.log("データを追加しました")})}},readIndexedDBAll=(e,t)=>new Promise(async(r,a)=>{let n=await opneIndexedDB(e),l=n.result,s=l.objectStoreNames;if(s.contains(t)){let e=l.transaction(t,"readonly"),a=e.objectStore(t),n=a.getAll();n.addEventListener("success",()=>{r(n)})}else a("オブジェクトストアが存在しません")}),readIndexedDBValue=(e,t,r)=>new Promise(async(a,n)=>{let l=await opneIndexedDB(e),s=l.result,i=s.objectStoreNames;if(i.contains(t)){let e=s.transaction(t,"readonly"),n=e.objectStore(t),l=n.get(r);l.addEventListener("success",()=>{a(l)})}else n("オブジェクトストアが存在しません")}),deleteIndexedDBValue=(e,t,r)=>new Promise(async(a,n)=>{let l=await opneIndexedDB(e),s=l.result,i=s.objectStoreNames;if(i.contains(t)){let e=s.transaction(t,"readwrite"),n=e.objectStore(t),l=n.delete(r);l.addEventListener("success",()=>{a(l)})}else n("オブジェクトストアが存在しません")})}},function(e){e.O(0,[717,952,251,971,472,744],function(){return e(e.s=7331)}),_N_E=e.O()}]);