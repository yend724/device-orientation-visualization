(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[130],{2890:function(e,t,r){Promise.resolve().then(r.bind(r,7325))},7325:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return page}});var a=r(7437),n=r(5318),l=r(2265);let useDeviceOrientation=()=>{let[e,t]=(0,l.useState)(!1),[r]=(0,l.useState)(()=>new AbortController),[a,n]=(0,l.useState)({alpha:0,beta:0,gamma:0}),s=(0,l.useCallback)(()=>(t(!0),window.addEventListener("deviceorientation",e=>{let{alpha:t,beta:r,gamma:a}=e;n({alpha:null!=t?t:0,beta:null!=r?r:0,gamma:null!=a?a:0})},{signal:r.signal}),{absortController:r}),[r]);return(0,l.useEffect)(()=>{let r=null;if(DeviceOrientationEvent&&!DeviceOrientationEvent.requestPermission&&t(!0),e){let e=s();r=e.absortController}return()=>{t(!1),null==r||r.abort()}},[r,e,s]),{...a,isPermission:e,permission:()=>{DeviceOrientationEvent&&DeviceOrientationEvent.requestPermission&&DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e?t(!0):alert("デバイス向きの取得の許可をしてください")})}}};var s=r(952);let DeviceOrientationLineGraph=e=>{let{orientationData:t,width:r=640,height:n=320}=e,o=(0,l.useRef)(null),i=(0,l.useRef)(null),c={top:20,right:20,bottom:20,left:50},d=r-c.left-c.right,u=n-c.top-c.bottom,g=(0,l.useMemo)(()=>s.BYU().domain([-30,0]).range([0,d]),[d]),m=(0,l.useMemo)(()=>s.BYU().domain([-180,360]).range([u,0]),[u]),f=s.jvg().x(e=>g(e[0])).y(e=>m(e[1])),{gamma:x,alpha:h,beta:p}=t.reduce((e,t)=>{let r=Date.now(),a=-((r-t.timestamp)/1e3*1);if(a<-30)return e;let n={gamma:[[a,t.gamma],...e.gamma],alpha:[[a,t.alpha],...e.alpha],beta:[[a,t.beta],...e.beta]};return n},{gamma:[],alpha:[],beta:[]});return(0,l.useEffect)(()=>{let e=o.current;if(e)return s.Ys(e).call(s.LLu(g).ticks(r>640?15:5).tickFormat(e=>0===e?"0秒前":"".concat(e))),()=>{s.Ys(e).selectAll("g").remove()}},[o,g,r]),(0,l.useEffect)(()=>{let e=i.current;if(e)return s.Ys(e).call(s.y4O(m).tickValues([-180,-90,0,90,180,270,360]).tickFormat(e=>360===e?"360deg":"".concat(e))),()=>{s.Ys(e).selectAll("g").remove()}},[i,m]),(0,a.jsxs)("svg",{width:r,height:n,children:[(0,a.jsx)("title",{children:"直近30秒間のデバイスの回転の値（alpha、beta、gamma）の折れ線グラフ"}),(0,a.jsx)("g",{ref:o,transform:"translate(".concat(c.left,",").concat(n-c.bottom,")")}),(0,a.jsx)("g",{ref:i,transform:"translate(".concat(c.left,",").concat(c.bottom,")")}),(0,a.jsx)("path",{className:"stroke-rose-300",transform:"translate(".concat(c.left,", ").concat(c.top,")"),fill:"none",strokeWidth:"2",d:f(h)}),(0,a.jsx)("path",{className:"stroke-green-300",transform:"translate(".concat(c.left,", ").concat(c.top,")"),fill:"none",strokeWidth:"2",d:f(x)}),(0,a.jsx)("path",{className:"stroke-sky-300",transform:"translate(".concat(c.left,", ").concat(c.top,")"),fill:"none",stroke:"blue",strokeWidth:"2",d:f(p)})]})},o={alpha:{bgColor:"bg-rose-300",color:"text-neutral-900"},gamma:{bgColor:"bg-green-300",color:"text-neutral-900"},beta:{bgColor:"bg-sky-300",color:"text-neutral-900"}},DeviceOrientationValues=e=>{let{alpha:t,gamma:r,beta:n}=e;return(0,a.jsxs)("dl",{className:"space-y-8",children:[(0,a.jsx)(DeviceOrientationValue,{type:"alpha",value:t}),(0,a.jsx)(DeviceOrientationValue,{type:"gamma",value:r}),(0,a.jsx)(DeviceOrientationValue,{type:"beta",value:n})]})},DeviceOrientationValue=e=>{let{type:t,value:r}=e;return(0,a.jsxs)("div",{className:"grid min-w-[8rem] grid-rows-2 gap-y-2 rounded-md p-4 ".concat(o[t].bgColor," ").concat(o[t].color),children:[(0,a.jsxs)("dt",{children:[t," の値"]}),(0,a.jsx)("dd",{children:r})]})};var i=r(305),c=r(6793),d=r(9050),u=r(3986);let g=(0,l.forwardRef)((e,t)=>{let{children:r,className:n,...l}=e;return(0,a.jsx)("dialog",{className:(0,u.m)("bg-neutral-900 border-solid border border-neutral-700 text-neutral-100",n),...l,ref:t,children:r})});g.displayName="Dialog";let useDialog=()=>{let e=(0,l.useRef)(null),warning=()=>{console.warn("Dialog is not mounted")},t=(0,l.useCallback)(()=>{if(!e.current){warning();return}e.current.showModal()},[]),r=(0,l.useCallback)(()=>{if(!e.current){warning();return}e.current.close()},[]),a=(0,l.useCallback)(()=>{if(!e.current){warning();return}return e.current.returnValue},[]);return{ref:e,open:t,close:r,getReturnValue:a}},getText=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return{trigger:e?"停止":"録画",title:e?"停止":"開始",action:e?"停止":"録画"}},Record=e=>{let{isRecording:t,onStart:r,onStop:n}=e,{ref:l,open:s,close:o}=useDialog(),i=getText(t);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.z,{onClick:s,children:(0,a.jsxs)("span",{children:[i.trigger,"する"]})}),(0,a.jsxs)(g,{ref:l,children:[(0,a.jsxs)("h2",{className:"px-6 py-4 text-lg",children:[i.title,"を開始しますか？"]}),(0,a.jsxs)("div",{className:"flex gap-4 px-6 py-4 text-end",children:[(0,a.jsxs)(d.z,{onClick:()=>{t?null==n||n():null==r||r(),o()},size:"small",children:[i.action,"する"]}),(0,a.jsx)(d.z,{onClick:o,autoFocus:!0,variant:"secondary",size:"small",children:"キャンセル"})]})]})]})},DeviceOrientation=()=>{let{alpha:e,gamma:t,beta:r,isPermission:n,permission:s}=useDeviceOrientation(),o=(0,l.useRef)({alpha:e,gamma:t,beta:r});o.current={alpha:e,gamma:t,beta:r};let[u,g]=(0,l.useState)({width:0,height:0}),[m,f]=(0,l.useState)([]),x=(0,l.useRef)([]),[h,p]=(0,l.useState)(!1),b=(0,l.useCallback)(e=>{if(null===e)return;let t=new AbortController,handleResize=()=>{g({width:e.clientWidth,height:e.clientHeight})};return handleResize(),window.addEventListener("resize",handleResize,{signal:t.signal}),()=>{t.abort()}},[]);return(0,l.useEffect)(()=>{let e;let loop=()=>{let t=Date.now(),{alpha:r,gamma:a,beta:n}=o.current,l={timestamp:t,alpha:r,gamma:a,beta:n};h&&(x.current=[l,...x.current]),f(e=>{let t=[l,...e];return t.slice(0,1801)}),e=requestAnimationFrame(loop)};return loop(),()=>{cancelAnimationFrame(e)}},[h]),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-[1fr_auto]",children:[(0,a.jsx)("div",{ref:b,className:"relative aspect-video w-full",children:(0,a.jsx)("div",{className:"absolute h-full w-full",children:(0,a.jsx)(DeviceOrientationLineGraph,{width:u.width,height:u.height,orientationData:m})})}),(0,a.jsxs)("div",{className:"grid grid-rows-[auto_1fr] gap-y-12",children:[(0,a.jsx)("div",{children:(0,a.jsx)(DeviceOrientationValues,{alpha:e,gamma:t,beta:r})}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-x-4",children:[(0,a.jsx)(d.z,{onClick:s,disabled:n,children:n?"許可済み":"許可する"}),(0,a.jsx)(Record,{onStart:()=>{p(!0)},onStop:()=>{p(!1);let e=x.current,t=e[e.length-1].timestamp,r=e[0].timestamp,a=(0,i.I)(e);(0,c.fo)(t,r,a),x.current=[]},isRecording:h})]})})]})]})},useClock=function(){let{initial:e=new Date("2000-01-01 00:00:00")}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,r]=(0,l.useState)(e);return(0,l.useEffect)(()=>{r(new Date);let e=null,loop=()=>{r(new Date),e=requestAnimationFrame(loop)};return loop(),()=>{e&&cancelAnimationFrame(e)}},[]),{currentTime:t}};var page=()=>{let{currentTime:e}=useClock();return(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-[auto_1fr]",children:[(0,a.jsx)("div",{className:"text-left",children:(0,a.jsx)(n.S,{currentTime:e})}),(0,a.jsx)("div",{children:(0,a.jsx)(DeviceOrientation,{})})]})}},9050:function(e,t,r){"use strict";r.d(t,{z:function(){return s}});var a=r(7437),n=r(2265),l=r(3986);let s=(0,n.forwardRef)((e,t)=>{let{children:r,variant:n,size:s,className:o,disabled:i,...c}=e;return(0,a.jsx)("button",{...c,ref:t,className:(0,l.m)("flex items-center justify-between gap-x-2 whitespace-nowrap rounded-md bg-neutral-50 px-4 py-2 text-neutral-900 hover:opacity-70 focus:border-neutral-50",o,"secondary"===n&&"bg-neutral-900 border border-neutral-50 text-neutral-50 hover:opacity-70","small"===s&&"text-sm px-2 py-1 rounded",i&&"cursor-not-allowed opacity-20 hover:opacity-20"),children:r})});s.displayName="Button"},5318:function(e,t,r){"use strict";r.d(t,{S:function(){return Clock}});var a=r(7437);let zeroPadding=(e,t)=>String(e).padStart(t,"0"),formatDateTimeToDigital=e=>{let t=e.getFullYear(),r=zeroPadding(e.getMonth()+1,2),a=zeroPadding(e.getDate(),2),n=zeroPadding(e.getHours(),2),l=zeroPadding(e.getMinutes(),2),s=zeroPadding(e.getSeconds(),2),o=zeroPadding(e.getMilliseconds(),3);return{date:"".concat(t,"-").concat(r,"-").concat(a),time:"".concat(n,":").concat(l,":").concat(s,".").concat(o)}},splitDateTime=e=>{let t=e.getFullYear(),r=e.getMonth()+1,a=e.getDate(),n=e.getHours(),l=e.getMinutes(),s=e.getSeconds(),o=e.getMilliseconds();return{year:t,month:r,date:a,hours:n,minutes:l,seconds:s,milliseconds:o}},AnalogClock=e=>{let{dateTime:t}=e,{hours:r,minutes:n,seconds:l}=splitDateTime(t);return(0,a.jsxs)("div",{className:"relative aspect-[1/1] w-[12rem] rounded-full bg-neutral-800 sm:w-[15rem]",children:[(0,a.jsx)("div",{style:{"--rotate-deg":"".concat((r+n/60)*30-90,"deg")},className:"absolute left-1/2 top-1/2 z-10 h-[6px] w-[30%] origin-[center_left] rotate-[var(--rotate-deg)] bg-neutral-50"}),(0,a.jsx)("div",{style:{"--rotate-deg":"".concat(6*n-90,"deg")},className:"absolute left-1/2 top-1/2 z-10 h-[4px] w-[40%] origin-[center_left] rotate-[var(--rotate-deg)] bg-neutral-50"}),(0,a.jsx)("div",{style:{"--rotate-deg":"".concat(6*l-90,"deg")},className:"absolute left-1/2 top-1/2 z-10 h-[4px]  w-[40%] origin-[center_left] rotate-[var(--rotate-deg)] bg-orange-500"}),(0,a.jsxs)("ol",{className:"relative h-full w-full text-center [&>li]:-translate-x-1/2 [&>li]:-translate-y-1/2",children:[(0,a.jsx)("li",{className:"absolute left-[70%] top-[14%]",children:"1"}),(0,a.jsx)("li",{className:"absolute left-[86%] top-[28%]",children:"2"}),(0,a.jsx)("li",{className:"absolute left-[90%] top-[50%]",children:"3"}),(0,a.jsx)("li",{className:"absolute left-[86%] top-[72%]",children:"4"}),(0,a.jsx)("li",{className:"absolute left-[70%] top-[86%]",children:"5"}),(0,a.jsx)("li",{className:"absolute left-[50%] top-[90%]",children:"6"}),(0,a.jsx)("li",{className:"absolute left-[30%] top-[86%]",children:"7"}),(0,a.jsx)("li",{className:"absolute left-[14%] top-[72%]",children:"8"}),(0,a.jsx)("li",{className:"absolute left-[10%] top-[50%]",children:"9"}),(0,a.jsx)("li",{className:"absolute left-[14%] top-[28%]",children:"10"}),(0,a.jsx)("li",{className:"absolute left-[30%] top-[14%]",children:"11"}),(0,a.jsx)("li",{className:"absolute left-[50%] top-[10%]",children:"12"})]})]})},DigitalClock=e=>{let{dateTime:t}=e,{date:r,time:n}=formatDateTimeToDigital(t);return(0,a.jsxs)("span",{className:"grid grid-rows-2 text-2xl",children:[(0,a.jsx)("span",{children:r}),(0,a.jsx)("span",{children:n})]})},Clock=e=>{let{currentTime:t}=e;return(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-8 text-center lg:flex-col",children:[(0,a.jsx)("div",{children:(0,a.jsx)(AnalogClock,{dateTime:t})}),(0,a.jsx)("div",{className:"flex items-center lg:block",children:(0,a.jsx)(DigitalClock,{dateTime:t})})]})}},305:function(e,t,r){"use strict";r.d(t,{I:function(){return convertArrayToBlob},r:function(){return readBlob}});let convertArrayToBlob=e=>new Blob([JSON.stringify(e)],{type:"application/json"}),readBlob=e=>new Promise((t,r)=>{let a=new FileReader;a.readAsText(e),a.onload=()=>{let e=a.result;"string"==typeof e?t(JSON.parse(e)):r("Blobの読み込みに失敗しました")}})},6793:function(e,t,r){"use strict";r.d(t,{DO:function(){return deleteIndexedDBValue},ZS:function(){return readIndexedDBValue},fQ:function(){return readIndexedDBAll},fo:function(){return saveOrientationData}});let opneIndexedDB=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Promise((r,a)=>{let n=indexedDB.open(e,t);n.addEventListener("upgradeneeded",()=>{let e=n.result;e.createObjectStore("recordStore",{autoIncrement:!0}),e.createObjectStore("rangeStore",{autoIncrement:!0})}),n.addEventListener("success",()=>{r(n)}),n.addEventListener("error",e=>{console.error("データベースを開けませんでした"),a(e)})})},saveOrientationData=async(e,t,r)=>{let a=await opneIndexedDB("DeviceOrientationVisualizationDB",1),n=a.result,l=n.objectStoreNames;if(l.contains("recordStore")){let t=n.transaction("recordStore","readwrite"),a=t.objectStore("recordStore");a.add(r,e.toString()),t.addEventListener("complete",()=>{console.log("データを追加しました")})}else console.error("オブジェクトストアが存在しません");if(l.contains("rangeStore")){let r=n.transaction("rangeStore","readwrite"),a=r.objectStore("rangeStore");a.add({start:e,end:t},e.toString()),r.addEventListener("complete",()=>{console.log("データを追加しました")})}},readIndexedDBAll=(e,t)=>new Promise(async(r,a)=>{let n=await opneIndexedDB(e),l=n.result,s=l.objectStoreNames;if(s.contains(t)){let e=l.transaction(t,"readonly"),a=e.objectStore(t),n=a.getAll();n.addEventListener("success",()=>{r(n)})}else a("オブジェクトストアが存在しません")}),readIndexedDBValue=(e,t,r)=>new Promise(async(a,n)=>{let l=await opneIndexedDB(e),s=l.result,o=s.objectStoreNames;if(o.contains(t)){let e=s.transaction(t,"readonly"),n=e.objectStore(t),l=n.get(r);l.addEventListener("success",()=>{a(l)})}else n("オブジェクトストアが存在しません")}),deleteIndexedDBValue=(e,t,r)=>new Promise(async(a,n)=>{let l=await opneIndexedDB(e),s=l.result,o=s.objectStoreNames;if(o.contains(t)){let e=s.transaction(t,"readwrite"),n=e.objectStore(t),l=n.delete(r);l.addEventListener("success",()=>{a(l)})}else n("オブジェクトストアが存在しません")})}},function(e){e.O(0,[717,952,971,472,744],function(){return e(e.s=2890)}),_N_E=e.O()}]);